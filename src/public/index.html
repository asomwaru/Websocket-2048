<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/index.css" />
    <title>Competitive 2048</title>
  </head>

  <body>
    <div class="grid" id="grid">
      <div></div>
      <div>2048</div>
      <div></div>
      <div></div>

      <div></div>
      <div></div>
      <div></div>
      <div></div>

      <div></div>
      <div></div>
      <div></div>
      <div></div>

      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </body>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/static/game.js"></script>
  <script>
    function oneDimtoTwoDim(grid) {
      let tempArr = [];

      while (grid.length) tempArr.push(grid.splice(0, 4));

      return tempArr;
    }

    function getGrid() {
      let gridElm = document.getElementById("grid");

      return [...gridElm.children].map((item) =>
        item.innerText ? parseInt(item.innerText) : 0
      );
    }

    function placeNum(grid) {
      let validSpots = [];

      for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {
          if (grid[i][j] === 0) {
            validSpots.push([i, j]);
          }
        }
      }

      let [row, col] =
        validSpots[Math.floor(Math.random() * validSpots.length)];

      let elm = document.getElementById("grid").children[row * 4 + col];
      let num = Math.random() > 0.5 ? 2 : 4;

      elm.innerHTML = num;
      elm.classList.add("n" + num);
    }

    function getMax(grid) {
      return Math.max(...grid);
    }

    let oneGrid = getGrid();
    let twoGrid = oneDimtoTwoDim([].concat(oneGrid));
    let connected = false;

    const socket = io("http://localhost:8080");

    socket.on("hello", () => {
      console.log("Got a message");
    });

    window.addEventListener("keydown", (event) => {
      event.preventDefault();
    });

    window.addEventListener("load", (event) => {
      event.preventDefault();

      placeNum(twoGrid);
      placeNum(twoGrid);

      socket.emit("waiting");
    });
  </script>
</html>
